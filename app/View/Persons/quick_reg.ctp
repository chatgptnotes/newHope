<?php 
//	echo $this->Html->script('jquery.autocomplete');
	echo $this->Html->script(array('jquery.fancybox','jquery.autocomplete'));
	echo $this->Html->css(array('jquery.autocomplete.css','jquery.fancybox.css'));  
	$referral = $this->request->referer(); 
	echo $this->Form->hidden('formReferral',array('value'=>'','id'=>'formReferral'));
    $docId=explode(',', $this->params->query['docId']);
?>
<style>
	label {
		width: 31px;
		padding: 0px;
	}
	.ui-widget-header {
		color : white;
	}
.tdLabel {
    color: #000;
    font-size: 13px;
    padding-left: 15px !important;
    padding-right: 0px !important;
    padding-top: 5px !important;
    text-align: left;
}


</style>
<?php 
	$flashMsg = $this->Session->flash('still') ;
	if(!empty($flashMsg)){ ?>
	<div>
		<?php echo $flashMsg ;?>
	</div> 
<?php } ?>
<?php 
		$attribute = '';
		
		if($online == false){
			$attribute = "empty=>Please Select";
		}
	 ?>
<div class="inner_title">
	<h3>
		&nbsp;
		<?php echo __('New Quick Registration', true); ?>
	</h3>

</div>
<div class="clr">&nbsp;</div>
<?php echo $this->Form->create('',array('type' => 'file','action'=>'quickReg','id'=>'PersonSearchForm'));?>
<!-- set static value for self pay option of tariffStandard (Payer) -->
<?php  echo $this->Form->hidden('Patient.tariff_standard_id', array('id'=>'tariff_standard_id','value'=>$privateID));
//echo $this->Form->hidden('Patient.location_id', array('id'=>'location_id','value'=>$this->Session->read('locationid')));?>
<table class="tdLabel formFull" width="100%" border="0" cellspacing="0" style="max-width: 1000px;"
	cellpadding="0">
	
	<!--<?php echo __('Volunteer/Staff Registration');?>-->
    <?php echo $this->Form->input('Person.is_staff_register', array('label'=>false,'type'=>'checkbox','class' => 'isStaff','id' => 'isStaff','style' => 'display:none;'  ));?></td>
	
	<tr>
    <td width="20%" class="tdLabel" id="boxSpace" style="display:none;"><?php echo __('Volunteer/Staff Registration');?></td>
    <td width="30%" style="display:none;">
        <?php 
            echo $this->Form->input('Person.is_staff_register', array(
                'type' => 'select',
                'options' => [
                    '1' => 'Yes',
                    '0' => 'No'
                ],
                'empty' => __('Please Select'),
                'label' => false,
                'class' => 'isStaff',
                'id' => 'isStaff'
            ));
        ?>
    </td>   
</tr>


	<tr id="staff" style="display:none">
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Staff Name');?></td>
		<td width="27%"><?php echo $this->Form->input('Person.staff_name', array('label'=>false,'type'=>'text','class' => 'staffName','id' => 'staffName'));?></td>
		<td valign="middle" class="tdLabel" id="boxSpace"></td>
		<td valign="middle" class="tdLabel" id="boxSpace"></td>
	</tr> 
        	
       <tr>
        <td id="google_translate_trigger" style="cursor: pointer; position:relative; left:16px;">Select language</td>
        <td id="google_translate_element"></td>
    </tr>
        <tr>
        <td colspan="2"><hr></td>
        <td colspan="2"><hr></td>
    </tr>
<tr>
    <td class="tdLabel"><?php echo __('Generated By:')?></td>
    <td>
        <?php 
            echo $this->Form->input('Person.qr_created_by', array(
                // 'class' => 'textBoxExpnd',
                'class' => 'yello_bg textBoxExpnd validate[required,custom[mandatory-date]]',
                'type' => 'select',
                'label' => false,
                'id' => 'generated_by',
                'options' => array_reduce($staffData, function($result, $item) {
					$result[$item['Staff']['staff_name']] = $item['Staff']['staff_name'];
					return $result;
				}, array('' => '-- Select --')),
                'autocomplete' => "off"
            ));
        ?>
    </td>

    <td class="tdLabel"><?php echo __('Company/Organization Name:')?></td>
    <td>
        <?php 
            echo $this->Form->input('Person.company_name', array(
                'class' => 'yello_bg textBoxExpnd validate[required,custom[mandatory-date]]',
                'type' => 'select',
                'label' => false,
                'id' => 'company_name',
                'options' => array_reduce($companyData, function($result, $item) {
    					$result[$item['CompanyName']['company_name']] = $item['CompanyName']['company_name'];
    					return $result;
    				}, array('' => '-- Select --')),
                    'autocomplete' => "off"
            ));
        ?>
    </td>
    
  <?php  
        echo $this->Form->input('Person.agent_id', array(
            'type' => 'hidden',
            'label' => false,
            'id' => 'agent_id'
        )); 
?>
    <!--<input type="hidden" id="agent_id" name="Person.agent_id" value="" readonly class="form-control">-->
<script>
    $(document).ready(function() {
    // Function to get the query parameter by name
    function getQueryParam(param) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    // Extract the 'id' from the URL and set it in the input field
    var agentId = getQueryParam('id');
    if (agentId) {
        // If 'id' exists in the URL, set it as the value of the input field
        $('#agent_id').val(agentId);
    }
});

</script>
</tr>

	<tr id="notStaff">
	   <td width="20%" valign="middle" class="tdLabel" id="boxSpace"><?php echo __("First Name");?><font color="red">*</font></td>
       <td width="27%">
       <table width="100%" cellpadding="0" cellspacing="0" border="0">
          <tr>
          	<td><?php echo $this->Form->input('Person.initial_id', array('empty'=>__('Select'),'options'=>$initials,'class' => 'validate[required,custom[mandatory-select]] textBoxExpnd','label'=>false,'id' => 'initials','style'=>'width:80px')); ?></td>
            <td>                            	 
            	<?php echo $this->Form->input('Person.first_name', array('style'=>'width:84%!important;','class' => 'yello_bg validate[required,custom[name],custom[onlyLetterSp]] textBoxExpnd','label'=>false,'id' => 'first_name','autocomplete'=>'off')); ?>
            </td>                           
          </tr>
      </table>
    </td> 
		<td valign="middle" class="tdLabel" id="boxSpace"><?php echo __('Last Name');?>
			<font color="red">*</font>
		</td>
		<td><?php echo $this->Form->input('Person.last_name', array('label'=>false,'style'=>'textTransform:capitalize;','class' => 'yello_bg validate[required,custom[onlyLetterSp],custom[mandatory-enter]] textBoxExpnd','id' => 'last_name','autocomplete'=>'off')); ?>
		</td>
	</tr>
	
	<tr>

		<td valign="middle" class="tdLabel" id="boxSpace"><?php echo __('Middle Name');?>
		</td> 
		<td><?php echo $this->Form->input('Person.middle_name', array('label'=>false,'class' => ' textBoxExpnd','id' => 'middle_name','size'=>'40','autocomplete'=>'off')); ?>
		</td>
		
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Age');?>
			<font color="red">*</font>
		</td>
		<td width="30%">
		
		<?php echo $this->Form->input('Person.age_year', array('div'=>false,'type'=>'text','style'=>'width:23px;float:left;','maxLength'=>'3','placeHolder'=>'  Y',
				'size'=>'20','class' => 'validate[required,custom[mandatory-enter],custom[onlyNumber]]','id' => 'age','label'=>false));
		echo $this->Form->input('Person.age_month', array('div'=>false,'type'=>'text','style'=>'width:23px;float:left;','maxLength'=>'2','placeHolder'=>'  M',
				'size'=>'20','class' => 'validate[required,custom[mandatory-enter],custom[onlyNumber]]','id' => 'ageMonth','label'=>false));

         echo $this->Form->input('Person.age_day', array('div'=>false,'type'=>'text','style'=>'width:23px;float:left;','maxLength'=>'2','placeHolder'=>'  D',
		'size'=>'20','class' => 'validate[required,custom[mandatory-enter],custom[onlyNumber]]','id' => 'ageDay','label'=>false));

		echo $this->Form->input('Person.dob', array('label'=>'DOB','div'=>false,'type'=>'text','class' => 'yello_bg textBoxExpnd validate[required,custom[mandatory-date]]',
					'style'=>'width: 118px;','readonly'=>'readonly', 'size'=>'20','id' => 'dob'));
		?>
		</td>
	<tr>
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Gender');?>
			<font color="red">*</font>
		</td>
		<td width="30%"><?php echo $this->Form->input('Person.sex', array('label'=>false,'options'=>array(''=>__('Please Select Gender'),
				'Male'=>__('Male'),'Female'=>__('Female'),'other'=>__('Other'),'prefer not to say'=>__('Prefer not to say')
			/*	'Unknown'=>__('Unknown'),'Other'=>__('Other')*/),'class' => 'yello_bg validate[required,custom[mandatory-select]] textBoxExpnd','id' => 'sex')); ?>
		</td>
		
		    <td class="tdLabel" id="boxSpace" valign="top"><?php echo __('Pin Code');?> <font color="red">* </font></td>
		<td valign="top"><?php echo $this->Form->input('Person.pin_code', array('class' => 'yello_bg validate[optional,custom[onlyNumber,minSize[6]]] textBoxExpnd','label'=>false,'id' => 'pinCode','Maxlength'=>'6','autocomplete'=>'off')); ?></td>
	</tr>
		<tr>
		
		<td class="tdLabel" id="boxSpace"><?php echo('State');?></td>
		<td id="customstate1"><?php //echo $this->Form->input('Person.state', array('options' => $newState,'empty' => 'Please Select State','label'=>false, 'id' => 'customstate', 'label'=> false, 'div' => false, 'error' => false,'class' => 'validate[required,custom[mandatory-select]] textBoxExpnd'));
		  echo $this->Form->input('stateName', array('class' => 'yello_bg validate[required,custom[mandatory-enter] textBoxExpnd','id' => 'stateName','label'=>false));
		 //	echo $this->Form->hidden('stateIdAuto',array('id'=>'stateId')) 
		 	echo $this->Form->hidden('Person.state',array('id'=>'stateId'))
		 ?></td>
		
		<td class="tdLabel" id="boxSpace"><?php echo __('City/Town');?></td>
		<td><?php // echo $this->Form->input('Person.city', array('class' => 'textBoxExpnd validate[required,custom[onlyLetterNumber]]','label'=>false,'id' => 'city')); 
		 	      echo $this->Form->input('Person.city', array('class' => 'yello_bg validate[required,custom[mandatory-enter] textBoxExpnd','id' => 'city','label'=>false));
		 	  ?></td>
	</tr>
	<tr>
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Mobile Number');?><font color="red">*</font></td>
		<td width="30%"><?php echo $this->Form->input('Person.mobile', array('label'=>false,'type'=>'text','class' => 'yello_bg validate[required,custom[phone,minSize[10],onlyNumber]] yello_bg textBoxExpnd '/* validate[required,custom[onlyNumber]]*/,'style'=>'width:136px','maxlength'=>'10','id' => 'phone_number','autocomplete'=>"off"));?></td>
				  <td style="width: 25%" valign="middle" class="tdLabel" id="boxSpace"><?php echo __('Blood Group');?></td>
		  <td style="width: 25%"><?php 
				  $blood_group = array("A+"=>"A+","A-"=>"A-","B+"=>"B+","B-"=>"B-","AB+"=>"AB+","AB-"=>"AB-","O+"=>"O+","O-"=>"O-");
				  echo $this->Form->input('Person.blood_group', array('empty'=>__('Please Select'),'options'=>$blood_group,'class' => 'yello_bg textBoxExpnd','id' => 'designation','style'=>'width:66%!important;','label' => false )); ?></td>
				  </td>
		
	</tr>
	
	<?php // vadodara will have multiple appoinments to multiple doctors
	if($this->Session->read('website.instance')!='vadodara'){?>
	<tr class="toggle-row">
	
	    <td class="tdLabel"><?php echo __('Primary Care Physician')?><font color="red">* </font></td>
		
		<td>
			<?php if($online == false){ ?>
				<?php  echo $this->Form->input('Patient.doctor_id', array('empty' => __('Please Select'),'options'=>$doctorlist,'selected' => $selected,'label'=>false,
						'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'doctor_id','value'=>Configure::read('default_doctor_selected') ));  ?> 
			<?php }else{ ?>
				<?php  echo $this->Form->input('Patient.doctor_id', array('options'=>$doctorlist,'selected' => $selected,'label'=>false,
						'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'doctor_id','value'=>Configure::read('default_doctor_selected') ));  ?> 
			<?php } ?>
		</td>
		
<td class="tdLabel"><?php echo __('Special Medical Requirements') ?></td>
<td>
    <?php 
        if ($online == false) {
            echo $this->Form->input('Patient.department_id', array(
                'empty' => __('Please Select'),
                'options' => $departments,
                'id' => 'department_id',
                'label' => false,
                'class' => 'textBoxExpnd department_id',
                'disabled' => 'disabled',
                'value' => ''
            ));
            echo $this->Form->hidden('', array(
                'name' => "data[Patient][department_id]",
                'id' => 'department_id1'
            ));
        } else {
            echo $this->Form->input('Patient.department_id', array(
                'empty' => __('Please Select'),
                'options' => $departments,
                'id' => 'department_id',
                'label' => false,
                'class' => 'textBoxExpnd department_id',
                'value' => '12' // Default value can be adjusted as needed
            ));
            echo $this->Form->hidden('', array(
                'name' => "data[Patient][department_id]",
                'id' => 'department_id1',
                'value' => '12' // Default value for hidden input
            ));
        }
    ?>
</td>

	</tr>
	<?php }?>
	<?php if($this->Session->read("website.instance")=="vadodara"){?>
	
	<tr class="toggle-row">
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Address');?><font color="red">* </font></td>
		<td width="30%"><?php echo $this->Form->input('Person.plot_no', array('class' => '','class' => 'validate[required,custom[customaddress1]] ','label'=>false,'id' => 'plot_no','autocomplete'=>'off','type'=>'textarea','cols'=>'2','rows'=>'2')); ?></td>
			<?php //multiple visit  type for  multiple appointmnets for vadodara
				if($this->Session->read("website.instance")!="vadodara"){ ?>
		<td class="tdLabel"><?php  echo __('Type of Enrollment'); ?><font color="red">* </font></td>
		<td><?php // echo $this->Form->input('Patient.treatment_type_txt',array('id'=>'treatment_type_txt','class'=>'textBoxExpnd ','div'=>false,'label'=>false,'error'=>false,'value'=>''));
				//echo $this->Form->hidden('Patient.treatment_type', array('type'=>'text','id'=>'treatment_type','value'=>'6'));
				if($online == false){				
					echo $this->Form->input('Patient.treatment_type', array('empty' => __('Please Select'),'options'=>$opdoptions,'label'=>false,
 								'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'opd_id' ));
				}else{
					echo $this->Form->input('Patient.treatment_type', array('options'=>$opdoptions,'label'=>false,
 								'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'opd_id' ));
				}
			?>		
		
		</td>
		<?php }?>
	</tr>
	<tr >
		<td width="20%"></td>
		<td width="30%"></td>
	    <td class="tdLabel" id="boxSpace" valign="top"><?php echo __('Zip');?></td>
		<td valign="top"><?php echo $this->Form->input('Person.pin_code', array('class' => 'validate[optional,custom[onlyNumber,minSize[6]]] textBoxExpnd','label'=>false,'id' => 'pinCode','Maxlength'=>'6','autocomplete'=>'off')); ?></td>
		
		</tr>
	<tr>
	<?php }else{?>
	
	<tr>
    <td class="tdLabel"><?php echo __('Emergency Contact Name')?><font color="red">*</font></td>
    <td><?php echo $this->Form->input('Person.next_of_kin_name', array('class'=>'yello_bg validate[required,custom[name],custom[onlyLetterSp]] textBoxExpnd','type'=>'text','label'=>false,'id' => 'next_of_kin_name','autocomplete'=>"off"));?></td>
    <td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Emergency Contact Mobile');?><font color="red">*</font></td>
    <td width="30%"><?php echo $this->Form->input('Person.next_of_kin_mobile', array('label'=>false,'type'=>'text','class' => 'yello_bg validate[required,custom[phone,minSize[10],onlyNumber]] textBoxExpnd','style'=>'width:136px','maxlength'=>'10','id' => 'next_of_kin_mobile','autocomplete'=>"off"));?></td>
</tr>

<tr>
    <td class="tdLabel"><?php echo __('Second Emergency Contact Name')?><font color="red">*</font></td>
    <td><?php echo $this->Form->input('Person.second_next_of_kin_name', array('class'=>'yello_bg validate[required,custom[name],custom[onlyLetterSp]] textBoxExpnd','type'=>'text','label'=>false,'id' => 'next_of_kin_name','autocomplete'=>"off"));?></td>
    <td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Second Emergency Contact Mobile');?><font color="red">*</font></td>
    <td width="30%"><?php echo $this->Form->input('Person.second_next_of_kin_mobile', array('label'=>false,'type'=>'text','class' => 'yello_bg validate[required,custom[phone,minSize[10],onlyNumber]] textBoxExpnd','style'=>'width:136px','maxlength'=>'10','id' => 'next_of_kin_mobile','autocomplete'=>"off"));?></td>
</tr>
	
	
	
	<tr>
		<td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Address Line 1');?> <font color="red">* </font></td>
		<td width="30%">
			<?php echo $this->Form->input('Person.plot_no', array('class' => 'textBoxExpnd','class' => 'yello_bg validate[required,custom[customaddress1]] textBoxExpnd','label'=>false,'id' => 'plot_no','autocomplete'=>'off')); ?></td>
			<td width="20%" class="tdLabel" id="boxSpace"><?php echo('Address Line 2');?> <font color="red">* </font></td>
		<td width="30%"><?php echo $this->Form->input('Person.landmark', array('class' => 'yello_bg validate[required,custom[customaddress1] textBoxExpnd','label'=>false,'id' => 'landmark','autocomplete'=>'off')); ?></td>
	</tr>
	
	<tr class="toggle-row">
 <td class="tdLabel"><?php  echo __(' Visit Type'); ?><font color="red">* </font></td>
			<td><?php // echo $this->Form->input('Patient.treatment_type_txt',array('id'=>'treatment_type_txt','class'=>'textBoxExpnd ','div'=>false,'label'=>false,'error'=>false,'value'=>''));
					//echo $this->Form->hidden('Patient.treatment_type', array('type'=>'text','id'=>'treatment_type','value'=>'6'));
					if($online == false){					
					echo $this->Form->input('Patient.treatment_type', array('empty'=>__('Please Select'),'options'=>$opdoptions,'label'=>false,
	 								'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'opd_id' ));
					}else{
						echo $this->Form->input('Patient.treatment_type', array('options'=>$opdoptions,'label'=>false,'class' => "textBoxExpnd validate[required,custom[mandatory-select]]",'id' => 'opd_id' ));
					}
				?>				
			
			</td>
		<td class="tdLabel " id="">Preferred Service Type<font color="red">*</font></td>
		<?php if($online == false){ ?>
			<td><?php echo $this->Form->input('Patient.tariff_standard_id', array( 'empty' => __('Please Select'), 'options'=>$tariff,'label'=>false,'class' => 'validate[required,custom[mandatory-select]] textBoxExpnd','id'=>'tariff')); ?></td>
			<td width="20%" class="tdLabel" id="boxSpace">&nbsp;</td>
		<?php }else{ ?>
			<td><?php echo $this->Form->input('Patient.tariff_standard_id', array('options'=>$tariff,'label'=>false,'class' => 'validate[required,custom[mandatory-select]] textBoxExpnd','id'=>'tariff')); ?></td>
			<td width="20%" class="tdLabel" id="boxSpace">&nbsp;</td>
		<?php } ?>
   </tr>
   <?php }?>




<tr class="toggle-row">
<td class="tdLabel"><?php echo __('Chronic Conditions') ?></td>
<td>
    <?php
    echo $this->Form->select(
        'Person.chronic_conditions',
        [
            '' => 'Select Condition', // Placeholder
            'Diabetes' => 'Diabetes',
            'Hypertension' => 'Hypertension',
            'Asthma' => 'Asthma',
            'Epilepsy' => 'Epilepsy',
            'None' => 'None',
            'Other' => 'Other (Specify)'
        ],
        [
            'class' => 'textBoxExpnd',
            'id' => 'chronic_conditions',
            'empty' => false, // Prevent empty value
            'onchange' => 'toggleOtherInput(this.value)',
        ]
    );
    ?>
    <div id="otherConditionDiv" style="display:none; margin-top: 2px !important;">
        <?php echo $this->Form->input(
            'Person.other_chronic_condition',
            [
                'class' => 'textBoxExpnd',
                'type' => 'text',
                'label' => false,
                'id' => 'other_chronic_condition',
                'autocomplete' => "off",
                'placeholder' => "Specify Other Condition",
                'style'=>"margin-top: 2px;"
            ]
        ); ?>
    </div>
</td>

<script>
    function toggleOtherInput(value) {
        const otherInputDiv = document.getElementById('otherConditionDiv');
        if (value === 'Other') {
            otherInputDiv.style.display = 'block';
        } else {
            otherInputDiv.style.display = 'none';
            document.getElementById('other_chronic_condition').value = ''; // Clear the input when hidden
        }
    }
</script>



		<td class="tdLabel"><?php echo __('Allergy')?>
		</td>
		<td><?php echo $this->Form->input('Person.allergy',array('class'=>'textBoxExpnd ','type'=>'text','label'=>false,'id' => 'allergy','autocomplete'=>"off"));?>
		</td>
	</tr>


	<tr class="toggle-row">
		 <td class="tdLabel"><?php echo __('E-mail Address')?>
		</td>
		<td><?php echo $this->Form->input('Person.email',array('class'=>'validate["",custom[email]] textBoxExpnd ','type'=>'text','label'=>false,'id' => 'person_email_address','autocomplete'=>"off"));?>
		</td>
		 
		<td class="tdLabel"><?php echo __('Current Medication')?>
		</td>
		<td><?php echo $this->Form->input('Person.current_medication',array('class'=>'textBoxExpnd ','type'=>'text','label'=>false,'id' => 'current_medication','autocomplete'=>"off"));?>
		</td>
	</tr>
	<!--known medical condition and consent to share medical information-->
	<tr class="toggle-row">
<td class="tdLabel"><?php echo __('Known Medical Conditions:')?></td>
<td>
    <?php 
        echo $this->Form->input('Person.known_medical_conditions', array(
            'class' => 'textBoxExpnd',
            'type' => 'select',
            'label' => false,
            'id' => 'known_medical_conditions',
            'options' => array(
                '' => '-- Select --',
                'Heart Disease' => 'Heart Disease',
                'Kidney Issues' => 'Kidney Issues',
                'Previous Surgeries' => 'Previous Surgeries',
                'None' => 'None',
                'Other (Specify)' => 'Other (Specify)' // Correctly added "Other (Specify)" option
            ),
            'autocomplete' => "off",
            'onchange' => "toggleOtherTextbox(this)"
        ));

        // Hidden Textbox for "Other (Specify)" input
        echo $this->Form->input('Person.other_known_medical_conditions', array(
            'type' => 'text',
            'class' => 'textBoxExpnd',
            'placeholder' => 'Please specify',
            'label' => false,
            'id' => 'other_known_medical_conditions',
            'style' => 'display:none; margin-top:10px;' // Initially hidden
        ));
    ?>
</td>

<script>
    // JavaScript function to toggle the textbox
    function toggleOtherTextbox(dropdown) {
        const otherTextbox = document.getElementById('other_known_medical_conditions');
        if (dropdown.value === 'Other (Specify)') {
            otherTextbox.style.display = 'block'; // Show the text box
            otherTextbox.focus(); // Automatically focus on the text box
        } else {
            otherTextbox.style.display = 'none'; // Hide the text box
            otherTextbox.value = ''; // Clear the value in the textbox if hidden
        }
    }
</script>


<td class="tdLabel"><?php echo __('Consent to Share Medical Information:')?></td>
<td>
    <?php echo $this->Form->input('Person.share_info', array(
        'class' => 'textBoxExpnd',
        'type' => 'select',
        'label' => false,
        'id' => 'share_info',
        'options' => array(
            '' => '-- Select --',
            'Yes' => 'Yes',
            'No' => 'No'
        ),
        'autocomplete' => "off"
    )); ?>
</td>

	</tr>
	<!-- Insurance -->
		<tr class="toggle-row">
        		<td class="tdLabel"><?php echo __('Insurance Informaton:')?>
            	</td>
            	    	<td><?php echo $this->Form->input('Person.insurence_information:',array('class'=>'textBoxExpnd ','type'=>'text','label'=>false,'id' => 'known_medical_conditions','autocomplete'=>"off"));?>
            		</td>
<td class="tdLabel"><?php echo __('Preferred Hospital:')?></td>
<td>
    <?php echo $this->Form->input('Person.preferred_hospital', array(
        'class' => 'textBoxExpnd',
        'type' => 'select',
        'label' => false,
        'id' => 'preferred_hospital',
        'options' => array(
            '' => '-- Select --',
            'Hope Hospital' => 'Hope Hospital',
            'Ayushman Nagpur Hospital' => 'Ayushman Nagpur Hospital',
            'Local Hospital' => 'Local Hospital',
            'Any Available' => 'Any Available'
        ),
        'autocomplete' => "off",
        'onchange' => "toggleTextbox(this.value)"
    )); ?>
    <div id="hospital_textbox" style="display:none; margin-top: 10px;">
        <?php echo $this->Form->input('Person.other_hospital', array(
            'class' => 'textBoxExpnd',
            'type' => 'text',
            'label' => false,
            'placeholder' => 'Specify hospital',
            'id' => 'other_hospital',
            'autocomplete' => "off"
        )); ?>
    </div>
</td>

<script>
    function toggleTextbox(value) {
        const textboxDiv = document.getElementById('hospital_textbox');
        if (value === 'Any Available') {
            textboxDiv.style.display = 'block';
        } else {
            textboxDiv.style.display = 'none';
        }
    }
</script>

    	</tr>
    	<!--Organ donare -->
    	<tr class="toggle-row" >
        	<td class="tdLabel"><?php echo __('Do Not Resuscitate (DNR) Order:')?></td>
<td>
    <?php echo $this->Form->input('Person.dnr', array(
        'class' => 'textBoxExpnd',
        'type' => 'select',
        'label' => false,
        'id' => 'dnr',
        'options' => array(
            '' => '-- Select --',
            'Yes' => 'Yes',
            'No' => 'No',
            'Undecided' => 'Undecided'
        ),
        'autocomplete' => "off"
    )); ?>
</td>

            	    <td class="tdLabel"><?php echo __('Organ Donor Status:')?></td>
<td>
    <?php echo $this->Form->input('Person.organ_donor', array(
        'class' => 'textBoxExpnd',
        'type' => 'select',
        'label' => false,
        'id' => 'organ_donor',
        'options' => array(
            '' => '-- Select --',
            'Yes' => 'Yes',
            'No' => 'No',
            'Prefer not to disclose' => 'Prefer not to disclose'
        ),
        'autocomplete' => "off"
    )); ?>
</td>

    	</tr>
    	<tr class="toggle-row">
<td class="tdLabel"><?php echo __('Language Preference:')?></td>
<td>
    <?php 
        // Dropdown for Language Preference
        echo $this->Form->input('Person.language_preference', array(
            'class' => 'textBoxExpnd',
            'type' => 'select',
            'label' => false,
            'id' => 'language_preference',
            'options' => array(
                '' => '-- Select --',
                'English' => 'English',
                'Hindi' => 'Hindi',
                'Marathi' => 'Marathi',
                'Other (Specify)' => 'Other (Specify)'
            ),
            'autocomplete' => "off",
            'onchange' => "toggleLanguageTextbox(this)"
        ));

        // Hidden Textbox for "Other (Specify)" input
        echo $this->Form->input('Person.other_language', array(
            'type' => 'text',
            'class' => 'textBoxExpnd',
            'placeholder' => 'Specify language',
            'label' => false,
            'id' => 'other_language',
            'style' => 'display:none; margin-top:10px;' // Initially hidden
        ));
    ?>
</td>

<script>
    // JavaScript function to toggle the textbox
    function toggleLanguageTextbox(dropdown) {
        const textboxDiv = document.getElementById('other_language');
        if (dropdown.value === 'Other (Specify)') {
            textboxDiv.style.display = 'block'; // Show the text box
            textboxDiv.focus(); // Automatically focus on the text box
        } else {
            textboxDiv.style.display = 'none'; // Hide the text box
            textboxDiv.value = ''; // Clear the value in the textbox if hidden
        }
    }
</script>


            	    	<td class="tdLabel"><?php echo __('Digital Signature for Consent and Terms Agreement:')?>
            		</td>
            	    	<td><?php echo $this->Form->input('Person.digital_signature',array('class'=>'textBoxExpnd ','type'=>'text','label'=>false,'id' => 'digital_signature','autocomplete'=>"off"));?>
            	</td>
    	</tr>
	<!--End BY online patients-->
	
	
	<tr class="toggle-row">
		 <td width="20%" class="tdLabel" id="boxSpace"><?php echo __('Patient does not have a mobile number');?></td>
		 
		<td width="30%"><?php echo $this->Form->input('Person.no_number', array('label'=>false,'type'=>'checkbox','class' => 'no_number','id' => 'no_number'));?></td>
		
	 <?php ?>
		<?php $websie=$this->Session->read("website.instance");
		if($websie=="kanpur"){?>
		<td class="tdLabel"><?php echo __('Weight')?></td>
		<td width="30%"><?php echo $this->Form->input('Patient.patient_weight', array('label'=>false,'type'=>'text','class' => ' validate[optional,custom[onlyNumber]]','style'=>'width:60px','maxlength'=>'3','autocomplete'=>"off",'div'=>false)); echo "&nbsp;"."Kg"?></td>
	<?php }?>
	  <!--code by dinesh tawade-->
		                   
						<td class="tdLabel" id="boxSpace">Consultation Own Patient</td>
						<td>
							<?php echo $this->Form->input('Person.own_patient', array('label' => false, 'type' => 'checkbox', 'class' => 'fake', 'id' => 'own_patient', 'value' => '1')); ?>
							<?php echo $this->Form->hidden('Person.own_patient_hidden', array('id' => 'own_patient_hidden', 'value' => '0')); ?>
						</td>
						<script>
							$('#own_patient').change(function() {
								if ($(this).is(':checked')) {
									$('#own_patient_hidden').val('1');
								} else {
									$('#own_patient_hidden').val('0');
								}
							});
						</script>
	
	</tr>
	 <?php  if($this->Session->read("website.instance")=='lifespring'){ ?>
	<tr id=row>
		<td class="tdLabel" id="boxSpace"><?php echo __('Is Pregnant');?></td>

		<td><?php echo $this->Form->checkbox('is_pregnent', array('legend'=>false,'label'=>false,'class' => 'is_pregnent','id'=>'is_pregnent','style'=>'float:left;')); ?>
        <span class="hideRow" style="display:none;" ><?php echo $this->Form->input('Person.pregnant_week',array('type'=>'text','legend'=>false,'label'=>false,'div'=>false,
					'class' =>'pregnant_week validate[optional,custom[onlyNumber]] ','style'=>'width:150px','autocomplete'=>'off','id' =>'pregnant_week'));?>Weeks</span>
		
		<td class="tdLabel hideRow" id="boxSpace" style="display: none;width:40px"><?php echo __('EDD');?>
		<td colspan="2" class=" hideRow" style="display: none"><?php echo $this->Form->input('Person.expected_date_del',array('type'=>'text','class'=>'textBoxExpnd edd ','label'=>false,'autocomplete'=>'off','id' => 'edd'));?>
		</td>
		</td>
	</tr>		  
	<tr>
	      <td class="tdLabel" id="boxSpace"><?php echo __('Coupon Name.');?></td>
	       <td><?php echo $this->Form->input('Patient.coupon_name', array('class' =>'coupon_name','value'=>$this->params->query['coupon_name'],'label'=>false,'id' =>'coupon_name')); ?>
	       <spane id="validcoupon" style='display:none; color:green' ><?php echo 'Valid Coupon'; ?></spane></td>
	                  
	         <td></td>
    </tr>  
<?php } ?> 
	<tr  class="toggle-row">
		<?php  ?>
		<?php if(Configure::read('allowTimelyQuickReg')){
				$d= $this->DateFormat->formatDate2LocalForReport(date('Y-m-d'),Configure::read('date_format'),true);
		}else {
				$d= $this->DateFormat->formatDate2LocalForReport(date('Y-m-d H:i:s'),Configure::read('date_format'),true);
				$CalenderTime = 'HH:II:SS';
		}?>
		<td class="tdLabel"><?php echo __('Registration Date ')?></td>
		<td><?php 
		 echo $this->Form->input('Patient.form_received_on', array('type'=>'text','class' => 'date textBoxExpnd ','readonly'=>'readonly','id' => 'date','label'=>false,'value'=>$d));?>
		</td>
		<?php if(Configure::read('allowTimelyQuickReg')){
			echo $this->Html->script(array('jquery.ui.timepicker')); /** conditionally loading JS */?>
		
		<td class="tdLabel"><?php echo __('Appointment time')?><font color="red">*</font></td>
		<td><?php echo $this->Form->input('Person.start_time', array('label'=>false,'class' => 'textBoxExpnd validate[required,custom[mandatory-enter]]',
				'readOnly'=>true,'id' => 'timepicker_start','value'=>date('H:i:00', (round(time() / (15 * 60)) * (15 * 60))))); ?></td>
		<?php }?>
	</tr>
	 
	<!--  <tr><?php echo __('Patient/Gaurdian has approved the following :');?>
	<?php echo __('Send mobile text notification');?></td>
		<td width="30%"><?php echo $this->Form->input('Person.mobile_permission', array('label'=>false,'type'=>'checkbox','class' => '','id' => 'mobile_permission'));?></td>
	
	<?php echo __('Send voice text notification');?></td>
		<td width="30%"><?php echo $this->Form->input('Person.voice_permission', array('label'=>false,'type'=>'checkbox','class' => '','id' => 'voice_permission'));?></td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
		<td>&nbsp;</td>
	</tr>
	-->
   
<tr class="toggle-row">
    <td width="20%" valign="middle" class="tdLabel" id="boxSpace"><?php echo __("Upload ID Proof"); ?></td>
    <td width="30%">
        <table width="100%" cellpadding="0" cellspacing="0" border="0">
            <tr>
                <td>
                    <?php 
                        // Dropdown for ID Proof types
                        echo $this->Form->input('Person.id_proof_type', array(
                            'type' => 'select',
                            'id' => 'id_proof_type',
                            'class' => '',
                            'options' => array(
                                '' => '-- Select ID Proof --',
                                'Aadhaar Card' => 'Aadhaar Card',
                                'PAN Card' => 'PAN Card',
                                'Voter ID' => 'Voter ID',
                                'Passport' => 'Passport',
                                'Driving License' => 'Driving License'
                            ),
                            'label' => false,
                            'div' => false,
                            'error' => false,
                            'onchange' => "toggleFileUpload(this.value)"
                        ));

                        // File upload for ID Proof
                        echo '<div id="upload_section" style="display:none; margin-top:10px;">';
                        echo $this->Form->input('Person.upload_image', array(
                            'type' => 'file',
                            'id' => 'patient_photo',
                            'class' => '',
                            'style' => 'float:left',
                            'label' => false,
                            'div' => false,
                            'error' => false
                        ));
                        echo $this->Form->hidden('Person.web_cam', array('id' => 'web_cam'));
                        echo $this->Html->image('/img/icons/webcam.png', array(
                            'id' => 'camera',
                            'title' => 'Capture photo from webcam'
                        ));
                        echo '<canvas width="320" height="240" id="parent_canvas" style="display:none;"></canvas>';
                        echo '</div>';
                    ?>
                </td>
                <td></td>
            </tr>
        </table>
    </td>
</tr>

<script>
    function toggleFileUpload(value) {
        const uploadSection = document.getElementById('upload_section');
        if (value && value !== '') {
            uploadSection.style.display = 'block'; // Show the upload section if an ID proof is selected
        } else {
            uploadSection.style.display = 'none'; // Hide the upload section if no ID proof is selected
        }
    }
</script>

	
		<?php  //multiple visit  type for  multiple appointmnets for vadodara
					if($this->Session->read("website.instance")=="vadodara"){ ?>
					<tr>
						<td colspan="4">
							<?php $countApp=0;
							echo multiApp($this->Form,$doctorlist,$departments,$opdoptions)?>						
						</td>
											
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td><b>Total : <span id="total">0</span></b></td>
						<?php echo $this->Form->hidden('Patient.total',array('id'=>'totAmt'));?>
					</tr>
					<tr>
					<?php if($this->Session->read('website.instance')=='vadodara'){?>
						<td>&nbsp;</td>
						<td>&nbsp;</td>
						<td class="tdLabel"><font size="5px" color="#F48F5B" style="font-weight: bold;">
						<?php echo $this->Form->input('Person.visit_charge',array('type'=>'hidden','id'=>'visit_input','div'=>false,'label'=>false))?>
						<span id="visit_charge"></span></font><br>
						<span><?php echo 'Pay Amount From Here'.$this->Form->input('Person.pay_amt',array('type'=>'checkbox','id'=>'pay_charge','div'=>false,'label'=>false))?></span></td>
						<?php }?></tr>
					<tr class='soapArea' style="display: none">
						<td class="tdLabel"><?php echo __('Treatment Advice :')?></td>
						<td></td>
					</tr>
					<tr>
						<td>&nbsp;</td>
						<td align="right" colspan="5"
							style="margin-top: 10px; float: right;"><input class="blueBtn" type="button"
							id="addAppButton" value="Add Appointments" onclick="addFields()">
						</td>
					</tr>
		<?php }?>

	<tr>
		<?php $role=$this->Session->read('role');?>
		<?php if(($role == Configure::read('doctorLabel')||$role == Configure::read('nurseLabel'))) {?>
		<td class="tdLabel"><?php echo __('Create Soap note')?>:</td>
		<td><?php echo $this->Form->input('setSoap',array('name'=>'setSoap','type'=>'checkbox','id'=>'setSoap','label'=>false));?>
		</td>
		
		<?php }?>
		<td class="tdLabel soapArea" style="display: none"><?php echo __('Advice :')?>
		</td>
		<td class='soapArea' style="display: none"><?php echo $this->Form->input('Patient.advice', array('type'=>'textarea','rows'=>'3','cols'=>'5','id' => 'advice','label'=>false));?>
		</td>
	</tr>
	
	<tr class='soapArea' style="display: none">
		<table width="100%" border="0" cellspacing="0" cellpadding="0"
			class='soapArea' style="display: none">
			<!-- row 1 -->
			<tr>
				<td width="100%" valign="top" align="left" colspan="6">
					<table width="100%" border="0" cellspacing="0" cellpadding="0"
						class="tabularForm" id='DrugGroup' class=""
						style="padding: 0px !important">
						<tr>
							<td width="100%" colspan='14'>
								<div id='successMsg'
									style='display: none; color: #78D73E; text-align: center'></div>
							</td>
						</tr>

						<tr>
							<td width="8%" height="20" align="left" valign="top"
								style="padding-right: 3px;">Drug Name</td>
							<td width="5%" height="20" align="left" valign="top" style="">Dose</td>
							<td width="5%" height="20" align="left" valign="top" style="">Form</td>
							<td width="5%" height="20" align="left" valign="top" style="">Route</td>
							<td width="5%" align="left" valign="top" style="">Frequency</td>
							<td width="3%" align="left" valign="top" style="">Days</td>
							<td width="3%" align="left" valign="top" style="">Qty</td>
							<td width="5%" align="left" valign="top" style="">Refills</td>
							<td width="5%" align="center" valign="top" style="">PRN</td>
							<td width="5%" align="center" valign="top" style="">DAW</td>
							<td width="20%" align="center" valign="top" style="">First Dose
								Date/Time</td>
							<td width="20%" align="center" valign="top" style="">Stop
								Date/Time</td>
							<td width="8%" align="center" valign="top" style="">Special
								Instruction</td>
							<td width="5%" align="center" valign="top" style="">Is Active</td>
						</tr>
						<?php $count = 1;?>
						<tr id="DrugGroup0">
							<td align="left" valign="top" style="padding-right: 3px"><?php echo $this->Form->input('', array('label'=>false,'type'=>'text','class' => 'drugText' ,'id'=>"drugText_0",'name'=> 'drugText[]','autocomplete'=>'off','counter'=>'0','style'=>'width:100px')); 
							echo $this->Form->hidden("",array('id'=>"drug_0",'name'=>'drug_id[]'));
							?>
							</td>
							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'empty'=>'Select','options'=>$dose,'style'=>'width:80px','class' => '','id'=>"dose_type0",'name' => 'dose_type[]')); ?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'empty'=>'Select','options'=>$strenght,'style'=>'width:80px','class' => '','id'=>"strength0",'name' => 'strength[]'));?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'empty'=>'Select','options'=>$route,'style'=>'width:80px','class' => '','id'=>"route_administration0",'name' => 'route_administration[]')); ?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'empty'=>'Select','options'=>Configure::read('frequency'),'style'=>'width:80px','class' => '','id'=>"frequency0",'name' => 'frequency[]')); ?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'size'=>2,'type'=>'text','class' => '','id'=>"day0",'name' => 'day[]')); ?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false,'size'=>2,'type'=>'text','class' => '','id'=>"quantity0",'name' => 'quantity[]')); ?>
							</td>

							<td align="left" valign="top"><?php echo $this->Form->input('', array('label'=>false, 'options'=>Configure::read('refills'),'empty'=>'Select','style'=>'width:80px','class' => '','id'=>"refills0",'name' => 'refills[]'));  ?>
							</td>
							<td align="center" valign="top"><?php $options = array(''=>'Select','0'=>'No','1'=>'Yes');
														echo $this->Form->input('', array( 'label'=>false,'options'=>$options,'class' => '','id'=>"prn0",'name' => 'prn[]'));?>
							</td>

							<td align="center" valign="top"><?php echo $this->Form->input('', array('label'=>false, 'options'=>$options,'class' => '','id'=>"daw0",'name' => 'daw[]'));?>
							</td>

							<td width="20%" align="center" valign="top"><?php echo $this->Form->input('', array('label'=>false,'type'=>'text','size'=>15, 'class'=>'my_start_date1 textBoxExpnd','style'=>'width:130px','name'=> 'start_date[]', 'id' =>"start_date0" ,'counter'=>0 )); ?>
							</td>

							<td width="20%" align="center" valign="top"><?php echo $this->Form->input('', array('label'=>false,'type'=>'text','size'=>15,'class'=>'my_end_date1 textBoxExpnd','style'=>'width:130px','name'=> 'end_date[]','id' => "end_date0",'counter'=>0)); ?>
							</td>

							<td align="center" valign="top"><?php echo $this->Form->textarea('', array('label'=>false,'size'=>2,'type'=>'textarea','class' => '','id'=>"special_instruction0",'name' => 'special_instruction[]','style'=>'width:150px'));?>
							</td>

							<td align="center" valign="top"><?php $options_active = array(''=>'Select','0'=>'No','1'=>'Yes');
														echo $this->Form->input('', array('label'=>false, 'options'=>$options_active,'class' => '','id'=>"isactive0",'name' => 'isactive[]'));?>
							</td>
						</tr>
					</table>
				</td>
			</tr>
			<!-- row 3 end -->
			<tr>
				<td>&nbsp;</td>
				<td align="right" colspan="5"
					style="margin-top: 10px; float: right;"><input type="button"
					id="addButton" value="Add"> <?php if($count > 1){?> <input
					type="button" id="removeButton" value="Remove"> <?php }else{ ?> <input
					type="button" id="removeButton" value="Remove"
					> <?php } ?></td>
			</tr>

		</table>
	</tr>

<?php
// Check if user is logged in
$loggedIn = isset($_SESSION['userid']); // Session me `user_id` set hone par login maana jaayega
?>

<script>
    $(document).ready(function() {
        <?php if (!$loggedIn): ?> // Agar user login nahi hai
            $('.toggle-row').hide();

            $('#fill-up-more-btn').click(function() {
                $('.toggle-row').toggle(); 
            });
        <?php endif; ?>
    });
</script>


	</tbody>
</table>
<table width="66%">
	<tr>
		<td class="row_title" align="right"><?php
		echo $this->Form->hidden('Person.printSheet',array('value'=>'1','id'=>'printSheet'));
		echo $this->Form->hidden('Person.admission_type', array('id' =>'admission_type','value'=>'OPD'));
		echo $this->Form->submit(__('Submit'),array('style'=>'margin: 0 10px 0 0;','class'=>'blueBtn','div'=>false,'label'=>false,'id'=>'submit'));
		
		if($isFingerPrintEnable=='1'){
		   echo $this->Form->submit(__('Capture Fingerprint'),array('style'=>'margin: 0 10px 0 0;','class'=>'blueBtn','div'=>false,'label'=>false,'id'=>'capturefingerprint'));
		   }
		
// 		echo $this->Html->link(__('Back'), array('controller'=>'Persons','action' => 'searchPerson'), array('escape' => false,'class'=>'blueBtn' ));
		?>
		</td>
		<td colspan="2">
        <?php echo $this->Form->button(__('Fill Up More Information'), array(
            'type' => 'button',
            'id' => 'fill-up-more-btn',
            'class' => 'blueBtn',
            'style' => 'margin: 0 10px 0 0;',
            'div' => false,
            'label' => false
        )); ?>
    </td>

	</tr>
</table>




<?php echo $this->Form->end();?>



<?php //$this->Form
		$count=0;
	function multiApp($formData,$doctorlist,$departments,$opdoptions){
		
		$multiAppHtml='<table id=multiAppTable>';
		$multiAppHtml.='<tr>';					
		$multiAppHtml.='<td><b>Treating Consultant</b></td>';
		$multiAppHtml.='<td><b>Speciality</b></td>';
		$multiAppHtml.='<td><b>Visit Type</b></td>';
		$multiAppHtml.='<td><b>Visit Charges</b></td>';
		$multiAppHtml.='</tr>';
		$multiAppHtml.='<tr id=multiRow_0>';
		$multiAppHtml.='<td>';
		$multiAppHtml.=$formData->input('Patient.doctor_id', array('empty'=>__('Please Select'),'options'=>$doctorlist,'label'=>false,
 							'class' => "textBoxExpnd validate[required,custom[mandatory-select]] ",'id' => 'doctor_id',
							'value'=>Configure::read('default_doctor_selected') ));
  		$multiAppHtml.='</td>';
  		$multiAppHtml.='<td>';
  		$multiAppHtml.=$formData->input('Patient.department_id', array('empty'=>__('Please Select'),'options'=>$departments,'id'=>'department_id','label'=>false,'class' => 'textBoxExpnd department_id', 'disabled'=>'disabled','value'=>''));
		$multiAppHtml.=$formData->hidden('',array('name'=>"data[Patient][department_id]",'id'=>'department_id1'));
  		$multiAppHtml.='</td>';
  		$multiAppHtml.='<td>';
  		$multiAppHtml.=$formData->input('Patient.treatment_type', array('empty'=>__('Please Select'),'options'=>$opdoptions,'label'=>false,
 								'class' => "textBoxExpnd validate[required,custom[mandatory-select]] visitApp",'id' => 'opd_id' ));
  		$multiAppHtml.='</td>';
  		$multiAppHtml.='<td><font size="3px" color="#F48F5B" style="font-weight: bold;">';
		$multiAppHtml.=$formData->input('Person.visit_charge',array('type'=>'hidden','id'=>'visit_input','div'=>false,'label'=>false));
		$multiAppHtml.='<span id="visit_charge"></span></font></td>';
		$multiAppHtml.='</tr>';
		$multiAppHtml.='<tr>';
		$multiAppHtml.='</tr>';
		$multiAppHtml.='</table>';
		return $multiAppHtml;

	}


?>

<script type="text/javascript">
    function googleTranslateElementInit() {
        new google.translate.TranslateElement({
            pageLanguage: 'en',
            includedLanguages: 'en,hi,mr',
            layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
            autoDisplay: false,
            gaTrack: false,
            googleLogo: false
        }, 'google_translate_element');
    }

    // Trigger translation element when clicking the td
    document.getElementById('google_translate_element').addEventListener('click', function() {
        var translateDiv = document.getElementById('google_translate_element');
        
        // If Google Translate is not initialized yet, do it here
        if (!google.translate || !google.translate.TranslateElement) {
            googleTranslateElementInit();
        }

        // Open/close the language selector when clicking the td
        var langSelect = document.querySelector('.goog-te-combo');
        if (langSelect) {
            langSelect.focus(); // Focus the language dropdown if already created
        }
    });

    document.addEventListener("DOMContentLoaded", function() {
        // Initialize the Google Translate Element after the page is loaded
        if (google && google.translate && google.translate.TranslateElement) {
            googleTranslateElementInit();
        }
    });
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>


<script>
//script to include datepicker
var website = '<?php echo $this->Session->read('website.instance')?>';	
var validateCoupon = true ;		
if(website=='lifespring'){ 	
	$("#p_first_name").autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "autocompleteForPatientNameAndDob",1,"Person.sex=female&Person.initial_id NOT =7","admin" => false,"plugin"=>false)); ?>",{
		width: 80,
		selectFirst: true,
		valueSelected:true,
		loadId : 'p_first_name,motherPersonId',
		onItemSelect:function (data1) { 
			$('#first_name').css('textTransform', 'unset');
			name = $('#p_first_name').val();
			splitedval = name.split(" ");  
			splitedvalfname =  splitedval[0]; 
			splitedvallname =  splitedval[1]; 
			$('#first_name').val("Baby of "+" "+splitedvalfname);
			$('#last_name').val(splitedvallname);
			$.ajax({
				type:'POST',
	   			url : "<?php echo $this->Html->url(array("controller" => 'persons', "action" => "getMotherData", "admin" => false));?>"+"/"+$('#motherPersonId').val(),
	   			 context: document.body,   
	   			success: function(data){
	   			 var data = jQuery.parseJSON(data); 
	   			$("#plot_no").val($.trim(data.Person.plot_no));
	   			$("#pinCode").val($.trim(data.Person.pin_code));
	   			$("#city").val($.trim(data.Person.city));
	   			$("#state").val($.trim(data.Person.state));
	   			$("#stateName").val($.trim(data.Person.state));
	   			$("#phone_number").val($.trim(data.Person.mobile));
	   			$("#patientFile").val($.trim(data.Person.landmark));
	   			$("#taluka").val($.trim(data.Person.taluka));
	   			$("#middle_name").val($.trim(data.Person.middle_name));
	   			$("#district").val($.trim(data.Person.district));
	   			$("#landmark").val($.trim(data.Person.landmark));
	   			$("#person_email_address").val($.trim(data.Person.email));
		   		}
			});
		}
	});				
	$('#coupon_name').keyup(function(){
		if($('#coupon_name').val() == ''){
			$("#coupon_name").validationEngine("hideAll");
			$('#validcoupon').hide();
			validateCoupon = true  ;
		}else{
			$('#validcoupon').hide();
			$('#coupon_name').validationEngine('showPrompt', 'Invalid Coupon', 'text', 'topRight', true);
			validateCoupon = false ;
		}
	});
	
		$("#coupon_name").autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "autocomplete","Coupon","batch_name",'null',"null",'null',"parent_id NOT='0'","admin" => false,"plugin"=>false)); ?>", {
			width: 80,
			selectFirst: true,
			onItemSelect:function (data) { 
				 name = $('#coupon_name').val();
				$.ajax({
					type:'POST',
		   			url : "<?php echo $this->Html->url(array("controller" => 'patients', "action" => "couponValidate","admin" => false));?>"+"/"+name,
		   			 context: document.body,   
		   			success: function(data){ 
		   				
		   				if($.trim(data) != 'Coupon Available' ){
		   					$('#validcoupon').hide();
							$('#coupon_name').validationEngine('showPrompt', data, 'text', 'topRight', true);
							validateCoupon = false;
		   				}else{
		   					$('#validcoupon').show();
		   					$("#coupon_name").validationEngine("hideAll");
		   					validateCoupon = true;
			   				}
			   		}
				}); 
			}
		});						
}

$(".edd").datepicker({
	showOn: "both",
	buttonImage: "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
	buttonImageOnly: true,
	changeMonth: true,
	changeYear: true,
	yearRange: '1950',
	minDate: new Date(),
	dateFormat: '<?php echo $this->General->GeneralDate();?>',		
});	
$('#is_pregnent').click(function(){			
	if($("#is_pregnent").is(':checked')){	
		$('.hideRow').show();
	}else{
		$('.hideRow').hide();
		$('#pregnant_week , #edd').val("");	
	}
});	

jQuery(document).ready(function() {	
	<?php if($this->Session->read('website.instance')=='vadodara'){ ?>
		$('#opd_id').attr('disabled',true);
		$('#pay_charge').attr('checked',true);
		$('#opd_id').change(function(){//to maintain treatment type  --yashwant
			$('#PersonSearchForm').append($('<input>').attr({'type':'hidden','name':'data[Patient][treatment_type]','value' : $(this).val()}));
		});
	<?php } ?>
	 
	var print="<?php echo isset($this->params->query['print'])?$this->params->query['print']:'' ?>";
	var OpdSheet="<?php echo isset($this->params->query['patientId'])?$this->params->query['patientId']:'' ?>";
	var referral = "<?php echo $referral ; ?>" ;
	  
	if(print && referral != '/' && $("#formReferral").val()=='' && OpdSheet){
		$("#formReferral").val('yes') ;
		var url="<?php echo $this->Html->url(array('controller'=>'Billings','action'=>'printAdvanceReceipt',$this->params->query['print'])); ?>";
	    window.open(url, "_blank","toolbar=0,scrollbars=1,location=0,status=1,menubar=0,resizable=1,width=900,height=500,left=100,top=100"); // will open new tab on document ready

	    var docID =<?php echo json_encode($docId);?>;
	       $.each(docID, function(index, value) { 
	    	   var url="<?php echo $this->Html->url(array('controller'=>'patients','action'=>'opd_print_sheet',$this->params->query['patientId'])); ?>"+"/"+value;
	   	       window.open(url, "_blank","toolbar=0,scrollbars=1,location=0,status=1,menubar=0,resizable=1,width=900,height=500,left=400,top=400");
	       
	       });
	}else if(OpdSheet &&  referral != '/' && $("#formReferral").val()==''){
		var docID =<?php echo json_encode($docId);?>;
	       $.each(docID, function(index, value) { 
		       var url="<?php echo $this->Html->url(array('controller'=>'patients','action'=>'opd_print_sheet',$this->params->query['patientId'])); ?>"+"/"+value;
		        window.open(url, "_blank","toolbar=0,scrollbars=1,location=0,status=1,menubar=0,resizable=1,width=900,height=500,left=200,top=200");
	       });
		}	 
	
	

if('<?php echo Configure::read('allowTimelyQuickReg')?>' == '1'){
	$('#timepicker_start').timepicker({
	    showLeadingZero: true,
	   minTime: {
	        hour: '<?php echo date('H'); ?>', minute: '<?php echo date('i')+1; ?>'//adding one to minutes to avoid current time appointment
	    },
	    maxTime: {
	    	hour: 23, minute: 0
	    },
	    showMinutes : true,
        minutes: {
            starts: 0,                  // first displayed minute
            ends: 45,                   // last displayed minute
            interval: 15 ,               // interval of displayed minutes
            manual: []                  // optional extra manual entries for minutes
        }
	});
}
	//for tariffstandard id-private
	  var pid='<?php echo $privateID;?>';
	  $('#tariff').val(pid);

var systemDateFormat = '<?php echo $this->Session->read('dateformat'); ?>';
if(systemDateFormat[0] == 'd') var formatSyntax = 'd/m/Y';
else if(systemDateFormat[0] == 'm') var formatSyntax = 'm/d/Y';
else if(systemDateFormat[0] == 'y') var formatSyntax = 'Y/m/d';
else var formatSyntax = 'd/m/y';
$('#ageMonth, #age,#ageDay').val('0');
var today = new Date();
$('#dob').val(today.format(formatSyntax));
	
	

$(document).on('click', 'setSoap', function () {
	$( "#start_date0" ).trigger( "focus" );
});

	$('#setSoap').click(function(){
		
		if($(this).is(":checked") === true)
			$('.soapArea').show();
		else
			$('.soapArea').hide();	
	});
	/*	var source = '<?php echo $isquickregsave ?>';*/
	/* if(source == '1'){
		var patientId = "<?php echo $patientId; ?>";
	/*	var doctorId = "<?php echo $doctorId; ?>";
	/*	alert('Patient Registered Successfully');
		var URL = "<?php echo $this->Html->url(array("controller" => "doctor_schedules", "action" => "doctor_event")); ?>"+"/patientid:"+patientId+"/doctorid:"++"/listflag:appt";
		parent.window.location.href = URL;
		//parent.$.fancybox.close();
	}*/
	$("#dob").datepicker({
		showOn : "both",
		buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
		buttonImageOnly : true,
		buttonText: "Calendar",
		changeMonth : true,
		changeYear : true,
		yearRange: '-100:' + new Date().getFullYear(),
		maxDate : new Date(),
		dateFormat:'<?php echo $this->General->GeneralDate();?>',
		onSelect : function() {
			$("#dob").validationEngine("hide");   
			//calculateAge();getYearMonth();getYearMonthDay();CalculateDiff1();
			$.ajax({
				url :  "<?php echo $this->Html->url(array('controller'=>'Persons','action'=>'getAgeFromDob')); ?>",
				method : "GET",
				data : "dob="+$('#dob').val(),
				beforeSend : function(){
					//$('#busy-indicator').show();
				},
				success : function(data){
					var age = jQuery.parseJSON(data);
					$('#age').val(age[0])
					setAge();//.trigger('change');
					$('#ageMonth').val(age[1]);
					$('#ageDay').val(age[2]);
					//$('#busy-indicator').hide();
				}
			});
		}
	});

	$('#ageMonth, #age,#ageDay').keyup(function (){
		$("#ageMonth, #age,#ageDay").validationEngine('hideAll');
		if(parseInt($('#ageMonth').val()) >= 12){
			$('#ageMonth').validationEngine('showPrompt', 'Month should be less than 12.', 'text', 'topRight', true);
			return false;
		}
      if(parseInt($('#ageDay').val()) > 31){
			$('#ageDay').validationEngine('showPrompt', 'Day should be less than 31.', 'text', 'topRight', true);
			return false;
		}
      if(isNaN($(this).val()) || $(this).val() == ''){
			$(this).validationEngine('showPrompt', 'Number Only', 'text', 'topRight', true);
			return false;
		}
		var ajaxUrl = "<?php echo $this->Html->url(array('controller'=>'Persons','action'=>'getDobFromAge')); ?>";
		var data = "years="+$('#age').val()+"&months="+$('#ageMonth').val()+"&days="+$('#ageDay').val();
		$.ajax({
			url : ajaxUrl,
			method : "GET",
			data : data,
			beforeSend : function(){
				//$('#busy-indicator').show();
			},
			success : function(data){
				$('#dob').val($.trim(data));
				if($('#initials').val() == '')
					setAge()
				//$('#age').trigger('change');
				//$('#busy-indicator').hide();
			}
		});
	});
	$( ".date" ).datepicker({
		showOn: "both",
		buttonImage: "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
		buttonImageOnly: true,
		buttonText: "Calendar",
		changeMonth: true,
		changeYear: true,
		changeTime:true,
		maxDate: new Date(),
		maxTime : true,
        showTime: true,  		
		yearRange: '1950',			 
		dateFormat:'<?php echo $this->General->GeneralDate($CalenderTime);?>',
		onSelect : function() {
			$(".date").validationEngine("hide");   
		}
	});
	 jQuery("#PersonSearchForm").validationEngine({
           // validateNonVisibleFields: true,
            updatePromptsPosition:true,
        });
	
	$('#submit').click(function() { 
		var validatePerson = jQuery("#PersonSearchForm").validationEngine('validate');
		<?php if($this->Session->read('website.instance')=='vadodara'){ ?>				
		billAmount=parseInt($('#total').text());
		//if the bill amount is zero avoid form from submitting for vadodara instance- Pooja
		if(isNaN(billAmount)|| billAmount==0){
			alert("Please Select Visit Type With Charges.");
			validatePerson = false;

		}
		<?php } ?>
		if($('#tariff_standard_id').val() == '')
			$("#tariff_standard_txt").val('');	 

		if(parseInt($('#ageMonth').val()) >= 12){
			$('#ageMonth').validationEngine('showPrompt', 'Month should be less than 12.', 'text', 'topRight', true);
			validatePerson = false;
		}
		if(parseInt($('#ageDay').val()) > 31){
			$('#ageDay').validationEngine('showPrompt', 'Day should be less than 31.', 'text', 'topRight', true);
			validatePerson = false;
		}
	
			if(validatePerson)
				$(this).css('display', 'none');
			if(!validateCoupon)
				$('#coupon_name').val('');
			 var input = $("<input>").attr("type", "hidden").attr("name", "data[Person][printSheet]").val("1");
		 //    $('#opd_id').attr('disabled',true);// comented because treatment type is not getting saved --yashwant 
	});
	
	$('#capturefingerprint').click(function() { 
		if($('#tariff_standard_id').val() == '')
			$("#tariff_standard_txt").val('');	 

		var validatePerson = jQuery("#PersonSearchForm").validationEngine('validate');
		if (validatePerson)
		{
			$(this).css('display', 'none');
			 var input = $("<input>").attr("type", "hidden").attr("name", "data[Person][capturefingerprint]").val("1");
             $('#PersonSearchForm').append($(input));
		}
	});
		
	jQuery("#templatecategoryfrm").validationEngine();
	$("#Person_id").autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "autocomplete","Person","Patient_uid","admin" => false,"plugin"=>false)); ?>", {
		width: 250,
		selectFirst: true
	});

//department doctors by pankaj w 
	$('#department_id').change(function(){
		var val='';
		$.ajax({
	      url: "<?php echo $this->Html->url(array("controller" => 'patients', "action" => "getDoctorByDepartmentWise", "admin" => false)); ?>"+"/"+$(this).val(),
	      context: document.body,          
	      success: function(data){ 	    	   
			 	if(data !== undefined && data !== null){
					    $("#doctor_id option").remove();
					    $('#doctor_id').append( "<option value='"+val+"'>Please Select</option>" );
						data1 = $.parseJSON(data);					
						$.each(data1, function(val, text) {
							if(val !='')
						    $('#doctor_id').append( "<option value='"+val+"'>"+text+"</option>" );
						});
				  
			  		}else{				  	
			  			$("#doctor_id option").remove();
			  			$('#doctor_id').append( "<option value='"+val+"'>Please Select</option>" );
			  		}
			  }
	      
	    });
	   });


	   /** for by default selected doctor's department-Atul**/
	   var docDefaultId='<?php echo Configure::read('default_doctor_selected')?>';
	   if(docDefaultId!=''){
	     $.ajax({
	      url: "<?php echo $this->Html->url(array("controller" => 'patients', "action" => "getDoctorsDept", "admin" => false)); ?>"+"/"+docDefaultId,
	      context: document.body,          
	      success: function(data){ 
	    	  $('#department_id').val(parseInt(data)); 
	       $('#department_id1').val(parseInt(data)); 
	       if(docDefaultId!='0')
	       $('#opd_id').attr('disabled',false);
	      }
	    });
	   }
});

$(document).on('change','#doctor_id, .doctorApp', function(){
	var selectedDoc=$(this).attr('id').split('_')[2];
	var selectedVal='';
	if(!isNaN(selectedDoc)){
		selectedVal=$('#opd_id_'+selectedDoc+' option:selected').val();
	}else{
		selectedVal=$('#opd_id option:selected').val();
	}
	if(selectedVal && !isNaN(selectedDoc)){
		resetTariff(selectedDoc);
	}else if(selectedVal){
		resetTariff(0);
	}
	if($(this).val()){
	    $.ajax({
	      url: "<?php echo $this->Html->url(array("controller" => 'patients', "action" => "getDoctorsDept", "admin" => false)); ?>"+"/"+$(this).val(),
	      context: document.body,          
	      success: function(data){
	    	  if(!isNaN(selectedDoc)){ 
		       $('#department_id_'+selectedDoc).val(parseInt(data)); 
		       $('#department_id-'+selectedDoc).val(parseInt(data)); 
		       $('#opd_id_'+selectedDoc).attr('disabled',false);
	    	  }else{
	    		  $('#department_id').val(parseInt(data)); 
			      $('#department_id1').val(parseInt(data)); 
			      $('#opd_id').attr('disabled',false);
		      }
	      }
	    });
	}else{
		if(!isNaN(selectedDoc)){		      			
			$('#department_id_'+selectedDoc).val(''); 
		    $('#department_id-'+selectedDoc).val(''); 
			$('#opd_id_'+selectedDoc).val('');
			$('#visitCharge_'+selectedDoc).text('');
			$('#visit_charge_'+selectedDoc).hide();
			$('#opd_id_'+selectedDoc).attr('disabled',true);
		}else{
			$('#department_id').val(''); 
		    $('#department_id1').val(''); 
			$('#opd_id').val('');
			$('#visit_charge').text('');
			$('#visit_charge').hide();
			$('#opd_id').attr('disabled',true);
		}
	}
   });

$('#initials').change(function(){
	$(".shows").hide();
	$("#row").show();
	//$('#first_name,#last_name').val('');
	var getInitial=$("#initials option:selected").val();
	if(getInitial=='2' || getInitial=='3' || getInitial=='6'){
		$("#sex").val('Female');
	}else if(getInitial=='1' || getInitial=='5') {
		$("#sex").val('Male');
	}else if(getInitial=='7') {
	$(".shows").show();
	$("#sex").val('');
	$("#row").hide();
	}else{
		$("#sex").val('');
	}
});

$('#sex').change(function(){
	var getSex=$("#sex option:selected").val();
	var ageValue=$('#age').val();
	var getInitial=$("#initials option:selected").val();	
	if(getSex=='Female'){
		if(ageValue=='' && getInitial=='7'){
			$("#initials").val('7');
		}else if(ageValue!='' && ageValue<=3){			
			$("#initials").val('7');
		}else if(ageValue!='' && (ageValue>3 && ageValue<=10)){			
			$("#initials").val('6');
		}else if(ageValue=='' || ageValue>=10) {			
			$("#initials").val('2');
		}
	}else if(getSex=='Male') {
		if(getInitial=='7'){
			$("#initials").val('7');
		}else if(ageValue!='' && ageValue<=3){			
			$("#initials").val('7');
		}else if(ageValue!='' && (ageValue>3 && ageValue<=10)){			
			$("#initials").val('5');
		}else if(ageValue=='' || ageValue>=10) {			
			$("#initials").val('1');
		}		
	}else{
		$("#initials").val('1');
	}
});
$('.no_number').on('change',function(){
	if($('#no_number').prop('checked')){
		//$('#phone_number').removeClass('validate[required]');
		jQuery('#phone_number').validationEngine('hide');
	}else{
		$('#phone_number').addClass('validate[required]');
	}
});

$('.no_email').on('change',function(){
	if($('#no_email').prop('checked')){
		//$('#person_email_address').removeClass('validate[required,custom[mandatory-enter]]');
		jQuery('#person_email_address').validationEngine('hide');
	}else{
		$('#person_email_address').addClass('validate[required,custom[mandatory-enter]]');
	}
});

$( document ).ready(function (){
	
	var counter = <?php echo $count?>;
	 $("#addButton").click(
				function() {
					$("#quickPatientRagistrationForm").validationEngine('detach'); 
					var newCostDiv = $(document.createElement('tr'))
					     .attr("id", 'DrugGroup' + counter);

					//var start= '<select style="width:80px;" id="start_date'+counter+'" class="" name="start_date[]"><input type="tex">';
					var str_option_value='<?php echo $str;?>';
					var route_option_value='<?php echo $str_route;?>';
					var dose_option_value='<?php echo $str_dose;?>';
					var dose_option ='<select style="width:80px;" id="dose_type'+counter+'" class="" name="dose_type[]"><option value="">Select</option>'+dose_option_value;
					var strength_option = '<select style="width:80px;" id="strength'+counter+'" class="" name="strength[]"><option value="">Select</option>'+str_option_value;
					var route_option = '<select style="width:80px;" id="route_administration'+counter+'" class="" name="route_administration[]"><option value="">Select</option>'+route_option_value;
					var frequency_option = '<select style="width:80px;" id="frequency'+counter+'" class="frequency" name="frequency[]"><option value="">Select</option><option value="as directed">as directed</option><option value="Daily">Daily</option><option value="BID">BID</option><option value="TID">TID</option><option value="QID">QID</option><option value="Q1h WA">Q1h WA</option><option value="Q2h WA">Q2h Wa</option><option value="Q4h">Q4h</option><option value="Q2h">Q2h</option><option value="Q3h">Q3h</option><option value="Q4-6h">Q4-6h</option><option value="Q6h">Q6h</option><option value="Q8h">Q8h</option><option value="Q12h">Q12h</option><option value="Q48h">Q48h</option><option value="Q72h">Q72h</option><option value="Nightly">Nightly</option><option value="QHS">QHS</option><option value="in A.M.">in A.M.</option><option value="Every Other Day">Every Other Day</option><option value="2 Times Weekly">2 Times Weekly</option><option value="3 Times Weekly">3 Times Weekly</option><option value="Q1wk">Q1wk</option><option value="Q2wks">Q2wks</option><option value="Q3wks">Q3wks</option><option value="Once a Month">Once a Month</option><option value="Add\'l Sig">Add\'l Sig</option></select>';
					var refills_option = '<select style="width:80px;" id="refills'+counter+'" class="" name="refills[]"><option value="">Select</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select>';
					var prn_option = '<select style="width:80px;" id="prn'+counter+'" class="" name="prn[]"><option value="">Select</option><option value="0">No</option><option value="1">Yes</option></select>';
					var daw_option = '<select style="width:80px;" id="daw'+counter+'" class="" name="daw[]"><option value="">Select</option><option value="0">No</option><option value="1">Yes</option></select>';
					var active_option = '<select style="width:80px;" id="isactive'+counter+'" class="" name="isactive[]"><option value="">Select</option><option value="0">No</option><option value="1">Yes</option></select>';
					//var route_opt = '<td><input type="text" size=2 value="" id="quantity'+counter+'" class="" name="quantity[]"></td>';
					var options = '<option value=""></option>';
					for (var i = 1; i < 25; i++) {
						if (i < 13) {
							str = i + 'am';
						} else {
							str = (i - 12) + 'pm';
						}
						options += '<option value="'+i+'"'+'>'
								+ str + '</option>';
					}

					timerHtml1 = '<td><table width="100%" border="0" cellspacing="0" cellpadding="0" align="center"><tr><td width="25%" height="20" align="center" valign="top"><select class="first" style="width: 80px;" id="first_'+counter+'" disabled="" name="drugTime['+counter+'][]">'
							+ options
							+ '</select></td> ';
					timerHtml2 = '<td width="25%" height="20" align="center" valign="top"><select class="second" style="width: 80px;" id="second_'+counter+'" disabled="" name="drugTime['+counter+'][]">'
							+ options
							+ '</select></td> ';
					timerHtml3 = '<td width="25%" height="20" align="center" valign="top"><select class="third" style="width: 80px;" id="third_'+counter+'" disabled="" name="drugTime['+counter+'][]">'
							+ options
							+ '</select></td> ';
					timerHtml4 = '<td width="25%" height="20" align="center" valign="top"><select class="forth" style="width: 80px;" id="forth_'+counter+'" disabled="" name="drugTime['+counter+'][]">'
							+ options
							+ '</select></td> ';
					timer = timerHtml1 + timerHtml2
							+ timerHtml3 + timerHtml4
							+ '</tr></table></td>';
					<?php //echo $this->Form->input('', array('type'=>'text','size'=>16, 'class'=>'my_start_date','name'=> 'start_date[]', 'id' =>"start_date".$i ,'counter'=>$i )); ?>
					var newHTml = '<td valign="top"><input  type="text" style="width:100px" value="" id="drugText_' + counter + '"  class=" drugText validate[optional,custom[onlyLetterNumber]]" name="drugText[]" autocomplete="off" counter='+counter+'>'+
							'<input  type="hidden"  id="drug_' + counter + '"  name="drug_id[]" ></td><td valign="top">'
							+ dose_option
							+ '</td><td valign="top">'
							+ strength_option
							+ '</td><td valign="top">'
							+ route_option
							+ '</td><td valign="top">'
							+ frequency_option
							+ '</td>'
							+ '<td valign="top"><input size="2" type="text" value="" id="day'+counter+'" class="" name="day[]"></td>'
							+ '<td valign="top"><input size="2" type="text" value="" id="quantity'+counter+'" class="" name="quantity[]"></td>'
							+ '<td valign="top">'
							+ refills_option
							+ '</td>'
							+ '<td valign="top" align="center">'
							+ prn_option
							+ '</td>'
							+ '<td valign="top" align="center">'
							+ daw_option
							+ '</td>'
							+ '<td valign="top" align="center"><input type="text" style="width:130px" value="" id="start_date' + counter + '"  class="my_start_date1 textBoxExpnd" name="start_date[]"  size="15" counter='+counter+'></td>'
							+ '<td valign="top" align="center"><input type="text" style="width:130px" value="" id="end_date' + counter + '"  class="my_end_date1 textBoxExpnd" name="end_date[]"  size="15" counter='+counter+'></td>'
							+ '<td valign="top" align="center"><textarea id="special_instruction' + counter + '"  name="special_instruction[]" "style"="width:150px"  size="16" counter='+counter+'></textarea></td>'
							+ '<td valign="top" align="center">'
							+ active_option
							+ '</td>'
							;
																						
					newCostDiv.append(newHTml);		 
					newCostDiv.appendTo("#DrugGroup");		
					$("#diagnosisfrm").validationEngine('attach'); 			 			 
					counter++;
					if(counter > 0) $('#removeButton').show('slow');

					$(".my_start_date1").live("focus",function() {

						$(this).datepicker({
									changeMonth : true,
									changeYear : true,
									yearRange : '1950',
									minDate : new Date(explode[0], explode[1] - 1,
											explode[2]),
											dateFormat:'<?php echo $this->General->GeneralDate('HH:II:SS');?>',
									showOn : 'both',
									buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
									buttonText: "Calendar",
									buttonImageOnly : true,
									onSelect : function() {
										$(this).focus();
									}
								});
			});
			var explode = admissionDate.split('-');
			$(".my_end_date1").live("focus",function() {
				
						$(this).datepicker({
									changeMonth : true,
									changeYear : true,
									yearRange : '1950',
									minDate : new Date(explode[0], explode[1] - 1,
											explode[2]),
											dateFormat:'<?php echo $this->General->GeneralDate('HH:II:SS');?>',
									showOn : 'both',
									buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
												buttonImageOnly : true,
												buttonText: "Calendar",
												onSelect : function() {
													$(this).focus();
												}
											});
						});

					//For live click
					
		$('.drugText').on('focus',function() {
			var currentId=	$(this).attr('id').split("_"); // Important
			var attrId = this.id;
			var counter = $(this).attr(
					"counter");
			if ($(this).val() == "") {
				$("#Pack" + counter).val("");
			}
			$(this).autocomplete( "<?php echo $this->Html->url(array("controller" => "Notes", "action" => "pharmacyComplete","PharmacyItem",'name',"drug_id",'MED_STRENGTH','MED_STRENGTH_UOM','MED_ROUTE_ABBR','Status=A',"admin" => false,"plugin"=>false)); ?>",
							{
								
								width : 250,
								selectFirst : true,
								valueSelected:true,
								minLength: 3,
								delay: 1000,
								isOrderSet:true,
								showNoId:true,
								loadId : $(this).attr('id')+','+$(this).attr('id').replace("Text_",'_')+','+$(this).attr('id').replace("drugText_",'dose_type')
								+','+$(this).attr('id').replace("drugText_",'strength')
									+','+$(this).attr('id').replace("drugText_",'route_administration'),
									
								onItemSelect:function(event, ui) {
									//lastSelectedOrderSetItem
									var compositStringArray = lastSelectedOrderSetItem.split("    ");
									if((compositStringArray[1] !== undefined) && (compositStringArray[1] != '')){
										var pharmacyIdArray = compositStringArray[1].split("|");
										var doseId = attrId.replace("drugText_",'dose_type');
										var routeId = attrId.replace("drugText_",'route_administration');
										var strengthId = attrId.replace("drugText_",'strength');
										$("#drug_"+currentId[1]).val(pharmacyIdArray[0]);
										
										$("#"+strengthId).val(pharmacyIdArray[2]);
										if($("#"+strengthId).val() == ''){
											$("#"+strengthId).append( new Option(pharmacyIdArray[2],pharmacyIdArray[2]) );
											if(pharmacyIdArray[2]!='')
											$("#"+strengthId).val(pharmacyIdArray[2]);
												else
													$("#"+strengthId).val("Select");
											$.ajax({

												  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration", "admin" => false)); ?>",
												  context: document.body,	
												  beforeSend:function(){
												    // this is where we append a loading image
												    $('#busy-indicator').show('fast');
													}, 	
													type: "POST",  
												  	data:{putArea:pharmacyIdArray[2],searchArea:'strength'},		  
												  	success: function(data){
															$('#busy-indicator').hide('slow');
												  			
												  	}				  			
												});
										}
										$("#"+routeId).val(pharmacyIdArray[3]);
										if($("#"+routeId).val() == ''){
											$("#"+routeId).append( new Option(pharmacyIdArray[3],pharmacyIdArray[3]) );
											if(pharmacyIdArray[3]!='')
											$("#"+routeId).val(pharmacyIdArray[3]);
												else
													$("#"+routeId).val('Select');
											$.ajax({

												  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration1", "admin" => false)); ?>",
												  context: document.body,	
												  beforeSend:function(){
												    // this is where we append a loading image
												    $('#busy-indicator').show('fast');
													}, 	
													type: "POST",  
												  	data:{putArea:pharmacyIdArray[3],searchArea:'route'},		  
												  	success: function(data){
															$('#busy-indicator').hide('slow');
												  			
												  	}				  			
												});
										}
										$("#"+doseId).val(pharmacyIdArray[1]);
										if($("#"+doseId).val() == ''){
											$("#"+doseId).append( new Option(pharmacyIdArray[1],pharmacyIdArray[1]) );
											
											if(pharmacyIdArray[1]!='')
												$("#"+doseId).val(pharmacyIdArray[1]);
											else
												$("#"+doseId).val('Select');
								
											$.ajax({

												  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration2", "admin" => false)); ?>",
												  context: document.body,	
												  beforeSend:function(){
												    // this is where we append a loading image
												    $('#busy-indicator').show('fast');
													}, 	
													type: "POST",  
												  	data:{putArea:pharmacyIdArray[1],searchArea:'dose'},		  
												  	success: function(data){
															$('#busy-indicator').hide('slow');
												  			
												  	}				  			
												});
										}
										
										
									}
								}
								
							});
			
		});  //EOF autocomplete


					//var admissionDate = <?php echo json_encode($splitDate[0]); ?>;
					//var explode = admissionDate.split('-');
					$(".my_end_date1").on("click",function() {
						
								$(this).datepicker({
											changeMonth : true,
											changeYear : true,
											yearRange : '1950',
											/*minDate : new Date(explode[0], explode[1] - 1,
													explode[2]),*/
											dateFormat:'<?php echo $this->General->GeneralDate('HH:II:SS');?>',
											showOn : 'button',
											buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
														buttonImageOnly : true,
														onSelect : function() {
															$(this).focus();
														}
													});
								});
					
			     });

	 $("#removeButton").click(function () {
			counter--;	
	 	$("#DrugGroup" + counter).remove();
	 		if(counter == 0) $('#removeButton').hide('slow');
	  });

	 $('.drugText').on('focus',function() {
					var currentId=	$(this).attr('id').split("_"); // Important
					var attrId = this.id;
					var counter = $(this).attr("counter");
					if ($(this).val() == "") {
						$("#Pack" + counter).val("");
					}
					$(this).autocomplete( "<?php echo $this->Html->url(array("controller" => "Notes", "action" => "pharmacyComplete","PharmacyItem",'name',"drug_id",'MED_STRENGTH','MED_STRENGTH_UOM','MED_ROUTE_ABBR','Status=A',"admin" => false,"plugin"=>false)); ?>",
									{
										
							width : 250,
							selectFirst : true,
							valueSelected:true,
							minLength: 3,
							delay: 1000,
							isOrderSet:true,
							showNoId:true,
							loadId : $(this).attr('id')+','+$(this).attr('id').replace("Text_",'_')+','+$(this).attr('id').replace("drugText_",'dose_type')
							+','+$(this).attr('id').replace("drugText_",'strength')
								+','+$(this).attr('id').replace("drugText_",'route_administration'),
								
							onItemSelect:function(event, ui) {
								//lastSelectedOrderSetItem
								var compositStringArray = lastSelectedOrderSetItem.split("    ");
								if((compositStringArray[1] !== undefined) && (compositStringArray[1] != '')){
									var pharmacyIdArray = compositStringArray[1].split("|");
									var doseId = attrId.replace("drugText_",'dose_type');
									var routeId = attrId.replace("drugText_",'route_administration');
									var strengthId = attrId.replace("drugText_",'strength');
									$("#drug_"+currentId[1]).val(pharmacyIdArray[0]);
									
									$("#"+strengthId).val(pharmacyIdArray[2]);
									if($("#"+strengthId).val() == ''){
										$("#"+strengthId).append( new Option(pharmacyIdArray[2],pharmacyIdArray[2]) );
										if(pharmacyIdArray[2]!='')
										$("#"+strengthId).val(pharmacyIdArray[2]);
											else
												$("#"+strengthId).val("Select");
										$.ajax({

											  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration", "admin" => false)); ?>",
											  context: document.body,	
											  beforeSend:function(){
											    // this is where we append a loading image
											    $('#busy-indicator').show('fast');
												}, 	
												type: "POST",  
											  	data:{putArea:pharmacyIdArray[2],searchArea:'strength'},		  
											  	success: function(data){
														$('#busy-indicator').hide('slow');
											  			
											  	}				  			
											});
									}
									$("#"+routeId).val(pharmacyIdArray[3]);
									if($("#"+routeId).val() == ''){
										$("#"+routeId).append( new Option(pharmacyIdArray[3],pharmacyIdArray[3]) );
										if(pharmacyIdArray[3]!='')
										$("#"+routeId).val(pharmacyIdArray[3]);
											else
												$("#"+routeId).val('Select');
										$.ajax({

											  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration1", "admin" => false)); ?>",
											  context: document.body,	
											  beforeSend:function(){
											    // this is where we append a loading image
											    $('#busy-indicator').show('fast');
												}, 	
												type: "POST",  
											  	data:{putArea:pharmacyIdArray[3],searchArea:'route'},		  
											  	success: function(data){
														$('#busy-indicator').hide('slow');
											  			
											  	}				  			
											});
									}
									$("#"+doseId).val(pharmacyIdArray[1]);
									if($("#"+doseId).val() == ''){
										$("#"+doseId).append( new Option(pharmacyIdArray[1],pharmacyIdArray[1]) );
										
										if(pharmacyIdArray[1]!='')
											$("#"+doseId).val(pharmacyIdArray[1]);
										else
											$("#"+doseId).val('Select');
							
										$.ajax({

											  url: "<?php echo $this->Html->url(array("controller" => 'app', "action" => "saveConfiguration2", "admin" => false)); ?>",
											  context: document.body,	
											  beforeSend:function(){
											    // this is where we append a loading image
											    $('#busy-indicator').show('fast');
												}, 	
												type: "POST",  
											  	data:{putArea:pharmacyIdArray[1],searchArea:'dose'},		  
											  	success: function(data){
														$('#busy-indicator').hide('slow');
											  			
											  	}				  			
											});
									}
								}
							}
							
						});

				});

	// var admissionDate = <?php echo json_encode($splitDate[0]); ?>;
		//var explode = admissionDate.split('-');
		$(".my_start_date1").on("click",function() {

					$(this).datepicker({
								changeMonth : true,
								changeYear : true,
								yearRange : '1950',
								/*minDate : new Date(explode[0], explode[1] - 1,
										explode[2]),*/
								dateFormat:'<?php echo $this->General->GeneralDate('HH:II:SS');?>',
								showOn : 'button',
								buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
								buttonImageOnly : true,
								onSelect : function() {
									$(this).focus();
								}
							});
		});

		//var admissionDate = <?php echo json_encode($splitDate[0]); ?>;
		//var explode = admissionDate.split('-');
		$(".my_end_date1").on("click",function() {
			
					$(this).datepicker({
								changeMonth : true,
								changeYear : true,
								yearRange : '1950',
								/*minDate : new Date(explode[0], explode[1] - 1,
										explode[2]),*/
								dateFormat:'<?php echo $this->General->GeneralDate('HH:II:SS');?>',
								showOn : 'button',
								buttonImage : "<?php echo $this->Html->url('/img/js_calendar/calendar.gif'); ?>",
											buttonImageOnly : true,
											onSelect : function() {
												$(this).focus();
											}
										});
					});
		$("#tariff_standard_txt").autocomplete("<?php echo $this->Html->url(array("controller" => "Laboratories", "action" => "testcomplete","TariffStandard",'id',"name",'null',"admin" => false,"plugin"=>false)); ?>", {
			width: 250,
			selectFirst: true,
			valueSelected:true,
			loadId : 'tariff_standard_txt,tariff_standard_id',
		
		});
		$('#tariff_standard_txt').keydown(function(){
			$("#tariff_standard_id").val('');	 
		}); 

		 $("#treatment_type_txt").autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "testcomplete", "TariffList","id","name","check_status=1","admin" => false,"plugin"=>false)); ?>", {
			width: 250,
			selectFirst: true,
			valueSelected:true,
			showNoId:true,
			loadId : 'treatment_type_txt,treatment_type'
		}); 
}); 

// for aadhar card we use id ssn 
$("#ssn1").focusout(function(){ 
	res=$("#ssn1").val();
	count=($("#ssn1").val()).length;
	str1=res.substring(0, 4);
	str2=res.substring(4, 8);
	str3=res.substring(8, 12);
	if(count=='12'){
		$("#ssn1").val(str1+'-'+str2+'-'+str3);
	}
	if(count=='0'){
		$('#ssn1').val("");
	}
});

//---------------------------------BOF Atul, for 1st letter uppercase-----------------------------

$('#first_name,#last_name').css('textTransform', 'capitalize'); 

		$('#stateName').autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "testcomplete","State","id","name",'null')); ?>", {
			   width: 250,
				selectFirst: true,
				valueSelected:true,
				showNoId:true,
			loadId : 'state,stateId',
		});
		$(document).on('focus','#city', function() {
		//$('#city').live('focus',function() { 
		 var getStateId=$('#stateId').val();
		 $(this).autocomplete("<?php echo $this->Html->url(array("controller" => "app", "action" => "testcomplete","City","id","name")); ?>"+'/'+'state_id='+getStateId,{
				width: 250,
				selectFirst: true,
				valueSelected:true,
	    		showNoId:true,
	    		loadId : 'city,cityId',
			});
		});
		// $( document ).ready(function() {
		//	 var zipData = $(this).val();
			 
			// });
		$("#pinCode").blur(function(){
			
		var zipData = $(this).val(); //alert(zipData);
		var zipCount =	( $(this).val().length); //alert(zipCount);
		if(zipCount == 6){
			
			$.ajax({
	        	url: "<?php echo $this->Html->url(array("controller" => 'Persons', "action" => "getStateCity")); ?>"+"/"+zipData,
	        	context: document.body,
	        	
				success: function(data){
					if(data !== undefined && data !== null){
						data1 = jQuery.parseJSON(data);
						//console.log(data1.zip);
						
						if(data1.zip['State']['id']){
							$('#stateId').val(data1.zip['State']['id']);
							$('#stateName').val(data1.zip['State']['name']);
							$('#city').val(data1.zip['PinCode']['city_name']);
						}
					 }	
				} 
	        });
		} else{
			$('#stateId').val("");
			$('#stateName').val("");
			$('#city').val("");
			}
				
		});

		$(document).ready(function(){
			//BOF web cam script
			 $('#camera').click(function(){
				$.fancybox(
					    {
					    	'autoDimensions':false,
					    	'width'    : '85%',
						    'height'   : '90%',
						    'autoScale': true,
						    'transitionIn': 'fade',
						    'transitionOut': 'fade',						    
						    'type': 'iframe',
						    'href': '<?php echo $this->Html->url(array( "action" => "webcam")); ?>'
				});
			});			
		   //EOF web cam script
		});
		$(document).on('change','#opd_id ,.visitApp',function(){
			var selectedDoc=$(this).attr('id').split('_')[2];
			var selectedVal='';var visitType='';var doctor_id='';			
			if(!isNaN(selectedDoc)){
				selectedVal=$('#opd_id_'+selectedDoc+' option:selected').val();
			}else{
				selectedVal=$('#opd_id option:selected').val();
			}
			if(!isNaN(selectedDoc)){
				$('#visit_charge_'+selectedDoc).text('');
				$('#visit_input_'+selectedDoc).val('');
				$('#visit_charge_'+selectedDoc).hide();
				$('#visit_input_'+selectedDoc).hide();				
				calTotal();
			}else{
				$('#visit_charge').text('');
				$('#visit_input').val('');
				$('#visit_charge').hide();
				$('#visit_input').hide();	
				calTotal();			
			}
			if(!isNaN(selectedDoc)){
				visitType=$('#opd_id_'+selectedDoc).val();
				doctor_id=$('#doctor_id_'+selectedDoc).val();
			}else{
				visitType=$('#opd_id').val();
				doctor_id=$('#doctor_id').val();
			}
			var tarifId=$('#tariff').val();
			var privateTarif="<?php echo $privateID?>";
			if(tarifId!=privateTarif)
				$('#pay_charge').attr('checked',false);
			<?php if($this->Session->read('website.instance')=='vadodara' ){?>
			$('#submit').hide();
			if(selectedVal){
			$.ajax({
	        	url: "<?php echo $this->Html->url(array("controller" => 'Persons', "action" => "getTariffAmount")); ?>"+"/"+visitType+"/"+doctor_id+"/"+tarifId,
	        	context: document.body,	        	
				success: function(data){
					if(data !== undefined && data !== null){
						data1 = jQuery.parseJSON(data);
						if(data1.charges!=false){
							if( typeof(data1.charges.TariffCharge)!='undefined' && data1.charges!=false ){
								if(typeof(data1.charges['TariffCharge']['id'])!='undefined'){
									if(data1.charges['TariffCharge']['nabh_charges']){
										if(!isNaN(selectedDoc)){
											$('#visit_charge_'+selectedDoc).show();
											$('#visit_input_'+selectedDoc).show();
											$('#visit_charge_'+selectedDoc).text($('#opd_id_'+selectedDoc+' option:selected').text()+' :'+data1.charges['TariffCharge']['nabh_charges']);
											$('#visit_input_'+selectedDoc).val(data1.charges['TariffCharge']['nabh_charges']);
											calTotal();
										}else{
											$('#visit_charge').show();
											$('#visit_input').show();
											$('#visit_charge').text($('#opd_id option:selected').text()+' :'+data1.charges['TariffCharge']['nabh_charges']);
											$('#visit_input').val(data1.charges['TariffCharge']['nabh_charges']);
											calTotal();

										}
										
									}else if(data1.charges['TariffCharge']['non_nabh_charges']){
										if(!isNaN(selectedDoc)){
											$('#visit_charge_'+selectedDoc).show();
											$('#visit_input_'+selectedDoc).show();
											$('#visit_charge_'+selectedDoc).text($('#opd_id_'+selectedDoc+' option:selected').text()+' :'+data1.charges['TariffCharge']['non_nabh_charges']);
											$('#visit_input_'+selectedDoc).val(data1.charges['TariffCharge']['non_nabh_charges']);
											calTotal();
										}else{
											$('#visit_charge').show();
											$('#visit_input').show();
											$('#visit_charge').text($('#opd_id option:selected').text()+' :'+data1.charges['TariffCharge']['non_nabh_charges']);
										    $('#visit_input').val(data1.charges['TariffCharge']['non_nabh_charges']);
										    calTotal();
										}
									}
									$('#location_id').val(data1.charges['User']['location_id']);
								}						
							}else if( typeof(data1.charges.TariffAmount)!='undefined' && data1.charges!=false ){
									if(data1.charges['TariffAmount']['id']){
									if(data1.charges['TariffAmount']['nabh_charges']){
										if(!isNaN(selectedDoc)){
											$('#visit_charge_'+selectedDoc).show();
											$('#visit_input_'+selectedDoc).show();
											$('#visit_charge_'+selectedDoc).text($('#opd_id_'+selectedDoc+' option:selected').text()+' :'+data1.charges['TariffAmount']['nabh_charges']);
											$('#visit_input_'+selectedDoc).val(data1.charges['TariffAmount']['nabh_charges']);
											calTotal();
										}else{
											$('#visit_charge').show();
											$('#visit_input').show();
											$('#visit_charge').text($('#opd_id option:selected').text()+' :'+data1.charges['TariffAmount']['nabh_charges']);
											$('#visit_input').val(data1.charges['TariffAmount']['nabh_charges']);
											calTotal();

										}
									}else if(data1.charges['TariffAmount']['non_nabh_charges']){
										if(!isNaN(selectedDoc)){
											$('#visit_charge_'+selectedDoc).show();
											$('#visit_input_'+selectedDoc).show();
											$('#visit_charge_'+selectedDoc).text($('#opd_id_'+selectedDoc+' option:selected').text()+' :'+data1.charges['TariffAmount']['non_nabh_charges']);
											$('#visit_input_'+selectedDoc).val(data1.charges['TariffAmount']['non_nabh_charges']);
											calTotal();
										}else{
											$('#visit_charge').show();
											$('#visit_input').show();
											$('#visit_charge').text($('#opd_id option:selected').text()+' :'+data1.charges['TariffAmount']['non_nabh_charges']);
										    $('#visit_input').val(data1.charges['TariffAmount']['non_nabh_charges']);
										    calTotal();
										}
									}
								}
							}
						}else{
							$('#visit_charge').hide();
							$('#visit_input').hide();
							$('#visit_charge').text('');
						    $('#visit_input').val('');
						    $(this).val('');
							alert('Charges for selcted service is not mapped for Selected Doctor. Please Select other service or map charges');
							$('#pay_charge').attr('checked',false);
						 }
						
					 }
					$('#submit').show();
				} 
	        });
			}
	        <?php }?>
			
		});		
		function setAge(){	
			var ageValue=$('#age').val();
			var getSex=$("#sex").val();	
			if(ageValue <=3){
	        	if(getSex=='Male'){
					$("#initials").val('7');
				}else if(getSex=='Female'){
					$("#initials").val('7');
				}else{
					$("#initials").val('7');
	            }
	        }else if(ageValue<=10){
				if(getSex=='Male'){
					$("#initials").val('5');
				}else if(getSex=='Female'){
					$("#initials").val('6');
				}else{
					$("#initials").val('5');
				}
			}else{
				if(getSex=='Male'){
					$("#initials").val('1');
				}else if(getSex=='Female'){
					$("#initials").val('2');
				}else{
					$("#initials").val('');
				}
				
			}	
		}

		$('#tariff').change(function(){
			var tarifId=$('#tariff').val();
			var privateTarif="<?php echo $privateID?>";
			if(tarifId!=privateTarif){
				$('#pay_charge').attr('checked',false);
			}else{
				$('#pay_charge').prop('checked',true);
			}
				resetAllTariff();				
		});

		//For resetting the charges on change of doctor or tariff - Vadodara
		function resetTariff(args){
			if(args=='0'){
				$('#opd_id').val('');
				$('#visit_charge').hide();
				$('#visit_input').hide();
				$('#visit_charge').text('');
			    $('#visit_input').val('');
			    calTotal();
			}else{
				$('#opd_id_'+args).val('');
				$('#visit_charge_'+args).hide();
				$('#visit_input_'+args).hide();
				$('#visit_charge_'+args).text('');
			    $('#visit_input_'+args).val('');
			    calTotal();
			}

		}


		//For resetting All the charges on change of doctor or tariff - Vadodara
		function resetAllTariff(){
			for(var i=0;i<=counterApp;i++){
				if(i=='0'){
					$('#opd_id').val('');
					$('#visit_charge').hide();
					$('#visit_input').hide();
					$('#visit_charge').text('');
				    $('#visit_input').val('');
				    calTotal();
				}else{
					$('#opd_id_'+i).val('');
					$('#visit_charge_'+i).hide();
					$('#visit_input_'+i).hide();
					$('#visit_charge_'+i).text('');
				    $('#visit_input_'+i).val('');
				    calTotal();
				}

			}

		}
		

		var counterApp='<?php echo $countApp+1;?>';
		function addFields(){
			var appendOption= "<option value=''>Please Select</option>";
			$("#multiAppTable")
			.append($('<tr>').attr({'id':'multiRow_'+counterApp})
				.append($('<td>').append($('<select>').attr({'id':'doctor_id_'+counterApp,'class':'textBoxExpnd validate[required,custom[mandatory-select]] doctorApp','type':'select','name':'Appointment[doctor_id][]'}).append(appendOption)))
				.append($('<td>').append($('<select>').attr({'id':'department_id_'+counterApp,'disabled':'disabled','class':'textBoxExpnd department_id','type':'select','name':'Appointment[department_id][]'}).append(appendOption)))
				.append($('<input>').attr({'type':'hidden','id':'department_id-'+counterApp,'class':'textBoxExpnd validate[required,custom[mandatory-enter]]','name':'Appointment[department_id][]'}))
	    		.append($('<td>').append($('<select>').attr({'id':'opd_id_'+counterApp,'disabled':'disabled','class':'textBoxExpnd validate[required,custom[mandatory-select]] visitApp','type':'select','name':'Appointment[treatment_type][]'}).append(appendOption)))
				//.append($('<input>').attr({'type':'hidden','id':'opd_val_'+counterApp,'name':'Appointment[treatment_type][]'}))
				.append($('<td>').append($('<font>').attr({'size':"3px" , 'color':"#F48F5B" , 'style':"font-weight: bold;"}).append($('<span>').attr({'id':'visit_charge_'+counterApp})).append($('<input>').attr({'type':'hidden','id':'visit_input_'+counterApp,'name':'Appointment[visit_charge][]'}))))
				.append($('</span></font></td>'))
				.append($('<td>').append($('<img>').attr('src',"<?php echo $this->webroot ?>theme/Black/img/cross.png")
						.attr({'class':'removeButton','id':'removeButton_'+counterApp,'title':'Remove current row'}).css('float','right')))
				.append($('</tr>'))
				);
			
			var doctorList = <?php echo json_encode($doctorlist);?>;
			$.each(doctorList, function(val, text) {
			    $('#doctor_id_'+counterApp).append( "<option value='"+val+"'>"+text+"</option>" );
			});

			var departmentList=<?php echo json_encode($departments);?>;
			$.each(departmentList, function(val, text) {
			    $('#department_id_'+counterApp).append( "<option value='"+val+"'>"+text+"</option>" );
			});

			var visitList=<?php echo json_encode($opdoptions);?>;
			$.each(visitList, function(val, text) {
			    $('#opd_id_'+counterApp).append( "<option value='"+val+"'>"+text+"</option>" );
			});  
			counterApp++;
		}

		$(document).on('click','.removeButton', function() {
			currentId=$(this).attr('id');
			splitedId=currentId.split('_');
			ID=splitedId['1'];
			$("#multiRow_"+ID).remove();	
			counterApp--;
			calTotal();
		});

		$('#no_email').click(function(){
		    if($( "#no_email" ).is(':checked') == true) {
		       $('#person_email_address').attr('disabled', 'disabled');
		       $( "#person_email_address" ).val("");
		    }else{ 
			   $('#person_email_address').removeAttr('disabled', 'disabled');        
		    }   
		});
		$('#no_number').click(function(){
		   if($( "#no_number" ).is(':checked') == true) {
		       $('#phone_number').attr('disabled', 'disabled');
		       $( "#phone_number" ).val("");
		    }else{ 
			   $('#phone_number').removeAttr('disabled', 'disabled');        
		    }   
		}); 

		function calTotal(){
			var total=0;
				for(var i=0;i<=counterApp;i++){
					if(i=='0'){
						vamt=parseInt($('#visit_input').val());
						if(isNaN(vamt))
							vamt=0;
						total=parseInt(total)+parseInt(vamt);
					}else{
						camt=parseInt($('#visit_input_'+i).val());
						if(isNaN(camt))
							camt=0;
						total=parseInt(total)+parseInt(camt);
					}
				}

				$('#total').text(total);
				$('#totAmt').val(total);
			}

     $('#isStaff').click(function(){			
        if($("#isStaff").is(':checked')){	
            $("#notStaff").hide();
            $("#staff").show();
            $("#staffName").focus();
            $("#initials").val('');
            $("#first_name").val('');
            $("#last_name").val('');
        }else{
            $("#notStaff").show();
            $("#staff").hide();
            $("#staffName").val('');
        }
    });

  
	$('#staffName').autocomplete("<?php echo $this->Html->url(array("controller" => "Accounting", "action" => "staffAutocomplete","admin" => false,"plugin"=>false)); ?>", {
			   width: 250,
				selectFirst: true,
				valueSelected:true,
				showNoId:true,
			    loadId : 'staffName',
		})
</script>
